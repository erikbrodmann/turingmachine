let lengthInsert,state=0,input=document.getElementById("input"),header=[],tempHeader=[],goodL=["B","T","P","S","X","V","E"],tempL="",stepCounter=0,running=0,auto=0,finished=0,speed=1e3,checker=0;function appStateRunning(){$("#start").addClass("disabled"),$("#start").attr("disabled",!0),console.log($("#start").attr("disabled",!0)),$("#gen_but_corr").addClass("disabled"),$("#speed").addClass("disabled"),$("#input").addClass("disabled"),$("#btn-doc").addClass("disabled"),$("#btn-tour").addClass("disabled"),$("#btn-genValid").addClass("disabled"),$("#btn-genInvalid").addClass("disabled")}function appStateStep(){$("#start").addClass("disabled"),$("#speed").addClass("disabled"),$("#input").addClass("disabled"),$("#btn-doc").addClass("disabled"),$("#btn-tour").addClass("disabled"),$("#btn-genValid").addClass("disabled"),$("#btn-genInvalid").addClass("disabled")}function generateRight(){if(tempHeader=[],input.value="",input.dispatchEvent(new Event("input")),tempHeader.push("B"),Math.floor(11*Math.random())>5?(tempHeader.push("T"),tempL="T"):(tempHeader.push("P"),tempL="P"),tempHeader.push("B"),Math.floor(11*Math.random())>5){for(tempHeader.push("P");Math.floor(11*Math.random())>4;)tempHeader.push("T");tempHeader.push("V"),tempHeader.push("V")}else{for(tempHeader.push("T");Math.floor(11*Math.random())>4;)tempHeader.push("S");if(tempHeader.push("X"),Math.floor(11*Math.random())>5)tempHeader.push("S");else{for(tempHeader.push("X");Math.floor(11*Math.random())>4;)tempHeader.push("T");tempHeader.push("V"),tempHeader.push("V")}}return tempHeader.push("E"),"T"===tempL?tempHeader.push("T"):"P"===tempL&&tempHeader.push("P"),tempHeader.push("E"),tempHeader}function displayWrongWord(){1===checker&&(alert("please click reload!"),window.location.reload()),checker=1,$("#btn-genValid").addClass("disabled"),$("#btn-genInvalid").addClass("disabled"),$("#btn-genValid").prop("disabled",!0),$("#btn-genInvalid").prop("disabled",!0);let e=generateRight();tempHeader.length>16&&window.location.reload(),tempHeader.length<9&&window.location.reload(),"T"===e[e.length-2]?e[e.length-2]="P":"P"===e[e.length-2]&&(e[e.length-2]="T"),$("#header").css("visibility","visible"),headerMovement(tempHeader),e=e.join(""),input.value=e,input.dispatchEvent(new Event("input"))}function displayRightWord(){1===checker&&(alert("please click reload!"),window.location.reload()),checker=1,$("#btn-genInvalid").addClass("disabled"),$("#btn-genValid").addClass("disabled"),$("#btn-genValid").prop("disabled",!0),$("#btn-genInvalid").prop("disabled",!0),input.value=generateRight().join(""),tempHeader.length>16&&generateRight(),tempHeader.length<9&&generateRight(),$("#header").css("visibility","visible"),headerMovement(tempHeader),input.dispatchEvent(new Event("input"))}function runAuto(){appStateRunning(),0===auto?(auto=1,autoStep()):1===auto&&(auto=0)}function setNewValue(){speed=500}function autoStep(){run(),1===auto&&setTimeout((()=>autoStep()),speed)}function checkWord(){for(let e=0;e<input.value.length;e++)if(!goodL.includes(input.value.charAt(e)))return!1;return!0}function run(){if(appStateStep(),0===running){if(!1===checkWord())return document.getElementById("input").style.border="2px solid red",console.log("Fehlgeschlagen"+state),errorNode("#q"+state),auto=0,0;header=input.value.split(""),running=1}runMachine(header[stepCounter],stepCounter)?(document.getElementById("input").style.border="2px solid green",stepCounter++,4!==state&&5!==state||stepCounter--):(document.getElementById("input").style.border="2px solid red",errorNode("#q"+state),console.log("Fehlgeschlagen"+state),auto=0),1!==finished&&(document.getElementById("output").value=header.join(""))}function reset(){$("#header").css("visibility","hidden");for(let e=0;e<header.length;e++)$("#t"+e).css("visibility","hidden");tempHeader=0,header=0,auto=0,state=0,stepCounter=0,finished=0}function runMachine(e,t){if(9===header.length)var n=[645,705,765,830,890,955,1015,1077,1139],i=[-310,-248,-186,-124,-62,0,62,124,186,248,310];if(10===header.length)n=[645,705,765,830,890,955,1015,1077,1139,1200],i=[-310,-248,-186,-124,-62,0,62,124,186,248,310,372];if(11===header.length)n=[645,705,765,830,890,955,1015,1077,1139,1200,1261],i=[-310,-248,-186,-124,-62,0,62,124,186,248,310,372,434];if(12===header.length)n=[584,645,705,765,830,890,955,1015,1077,1139,1200,1261],i=[-372,-310,-248,-186,-124,-62,0,62,124,186,248,310,372,434];if(13===header.length)n=[584,645,705,765,830,890,955,1015,1077,1139,1200,1261,1322],i=[-372,-310,-248,-186,-124,-62,0,62,124,186,248,310,372,434,496];if(14===header.length)n=[523,584,645,705,765,830,890,955,1015,1077,1139,1200,1261,1322],i=[-434,-372,-310,-248,-186,-124,-62,0,62,124,186,248,310,372,434,496];if(15===header.length)n=[523,584,645,705,765,830,890,955,1015,1077,1139,1200,1261,1322,1383],i=[-434,-372,-310,-248,-186,-124,-62,0,62,124,186,248,310,372,434,496,558];if(16===header.length)n=[462,523,584,645,705,765,830,890,955,1015,1077,1139,1200,1261,1322,1383,1444],i=[496,-434,-372,-310,-248,-186,-124,-62,0,62,124,186,248,310,372,434,496,558,620];switch(findNode(q0),state){case 0:return"B"===e&&(state=1,header[t]="_",removeTape(n[t]),svgAnimation(i[t]),findNode(q1),!0);case 1:return("T"===e||"P"===e)&&(state=2,findNode(q2),svgAnimation(i[t]),!0);case 2:return"B"===e&&(state=8,header[t]="_",removeTape(n[t]),svgAnimation(i[t]),findNode(q8),!0);case 3:return"T"===e?(state=4,header[t]="_",removeTape(n[t]),svgAnimation(i[t]),findNode(q4),!0):"P"===e&&(state=5,header[t]="_",removeTape(n[t]),svgAnimation(i[t]),findNode(q5),!0);case 4:for(let e=t;e>=0;e--){if("T"===header[e])return state=6,header[e]="_",removeTape(n[e]),svgAnimation(i[e]),findNode(q6),!0;if(0===e&&"T"!==header[e])return!1}break;case 5:for(let e=t;e>=0;e--){if("P"===header[e])return state=6,header[e]="_",removeTape(n[e]),svgAnimation(i[e]),findNode(q6),!0;if(0===e&&"P"!==header[e])return!1}break;case 6:return"E"===e&&(state=7,header[t]="_",removeTape(n[t]),svgAnimation(i[t]),findNode(q7),!0);case 7:return running=0,auto=0,finished=1,!0;case 8:return"T"===e?(state=12,header[t]="_",removeTape(n[t]),svgAnimation(i[t]),findNode(q12),!0):"P"===e&&(state=9,header[t]="_",removeTape(n[t]),svgAnimation(i[t]),findNode(q9),!0);case 9:return"T"===e?(state=9,header[t]="_",removeTape(n[t]),svgAnimation(i[t]),findNode(q9),!0):"V"===e&&(state=10,header[t]="_",removeTape(n[t]),svgAnimation(i[t]),findNode(q10),!0);case 10:return"P"===e?(state=13,header[t]="_",removeTape(n[t]),svgAnimation(i[t]),findNode(q13),!0):"V"===e&&(state=11,header[t]="_",removeTape(n[t]),svgAnimation(i[t]),findNode(q11),!0);case 11:return"E"===e&&(state=3,header[t]="_",removeTape(n[t]),svgAnimation(i[t]),findNode(q3),!0);case 12:return"S"===e?(state=12,findNode(q12),header[t]="_",removeTape(n[t]),svgAnimation(i[t]),!0):"X"===e&&(state=13,header[t]="_",removeTape(n[t]),svgAnimation(i[t]),findNode(q13),!0);case 13:return"S"===e?(state=11,header[t]="_",removeTape(n[t]),svgAnimation(i[t]),findNode(q11),!0):"X"===e&&(state=9,header[t]="_",removeTape(n[t]),svgAnimation(i[t]),findNode(q9),!0)}}function findNode(e){$("svg").find(e).css({fill:"#29a744"})}function errorNode(e){$("svg").find(e).css({fill:"red"})}function svgAnimation(e){anime({targets:".header",translateX:e,easing:"easeInOutExpo",duration:10})}function insertTape(e,t){d3.select(".tape").append("text").attr("id","t"+t).attr("x",t).attr("y","45").style("font-family","Avenir-Book,Avenir,Helvetica, Helvetica Neue,Arial, Georgia, sans-serif").style("font-size","20px").text(e[0])}function headerMovement(e){if(e.length<9&&($("#header").css("visibility","hidden"),appStateRunning(),alert("too small")),e.length>16&&($("#header").css("visibility","hidden"),appStateRunning(),alert("too large")),9===e.length){for(let e=-5;e<4;e++)$("#t"+e).css("visibility","visible");svgAnimation(-310),lengthNine(e)}if(10===e.length){for(let e=-5;e<5;e++)$("#t"+e).css("visibility","visible");svgAnimation(-310),lengthTen(e)}if(11===e.length){for(let e=-5;e<6;e++)$("#t"+e).css("visibility","visible");svgAnimation(-310),lengthEleven(e)}if(12===e.length){for(let e=-6;e<6;e++)$("#t"+e).css("visibility","visible");svgAnimation(-372),lengthTwelf(e)}if(13===e.length){for(let e=-6;e<7;e++)$("#t"+e).css("visibility","visible");svgAnimation(-372),lengthThirteen(e)}if(14===e.length){for(let e=-7;e<7;e++)$("#t"+e).css("visibility","visible");svgAnimation(-434),lengthFourteen(e)}if(15===e.length){for(let e=-7;e<8;e++)$("#t"+e).css("visibility","visible");svgAnimation(-434),lengthFiveteen(e)}if(16===e.length){for(let e=-8;e<8;e++)$("#t"+e).css("visibility","visible");svgAnimation(-496),lengthSixteen(e)}}function lengthNine(e){insertTape(e[0],lengthInsert.mfive),insertTape(e[1],lengthInsert.mfour),insertTape(e[2],lengthInsert.mthree),insertTape(e[3],lengthInsert.mtwo),insertTape(e[4],lengthInsert.mone),insertTape(e[5],lengthInsert.zero),insertTape(e[6],lengthInsert.one),insertTape(e[7],lengthInsert.two),insertTape(e[8],lengthInsert.three)}function lengthTen(e){lengthNine(e),insertTape(e[9],lengthInsert.four)}function lengthEleven(e){lengthTen(e),insertTape(e[10],lengthInsert.five)}function lengthTwelf(e){insertTape(e[0],lengthInsert.msix),insertTape(e[1],lengthInsert.mfive),insertTape(e[2],lengthInsert.mfour),insertTape(e[3],lengthInsert.mthree),insertTape(e[4],lengthInsert.mtwo),insertTape(e[5],lengthInsert.mone),insertTape(e[6],lengthInsert.zero),insertTape(e[7],lengthInsert.one),insertTape(e[8],lengthInsert.two),insertTape(e[9],lengthInsert.three),insertTape(e[10],lengthInsert.four),insertTape(e[11],lengthInsert.five)}function lengthThirteen(e){lengthTwelf(e),insertTape(e[12],lengthInsert.six)}function lengthFourteen(e){insertTape(e[0],lengthInsert.mseven),insertTape(e[1],lengthInsert.msix),insertTape(e[2],lengthInsert.mfive),insertTape(e[3],lengthInsert.mfour),insertTape(e[4],lengthInsert.mthree),insertTape(e[5],lengthInsert.mtwo),insertTape(e[6],lengthInsert.mone),insertTape(e[7],lengthInsert.zero),insertTape(e[8],lengthInsert.one),insertTape(e[9],lengthInsert.two),insertTape(e[10],lengthInsert.three),insertTape(e[11],lengthInsert.four),insertTape(e[12],lengthInsert.five),insertTape(e[13],lengthInsert.six)}function lengthFiveteen(e){lengthFourteen(e),insertTape(e[14],lengthInsert.seven)}function lengthSixteen(e){insertTape(e[0],lengthInsert.meight),insertTape(e[1],lengthInsert.mseven),insertTape(e[2],lengthInsert.msix),insertTape(e[3],lengthInsert.mfive),insertTape(e[4],lengthInsert.mfour),insertTape(e[5],lengthInsert.mthree),insertTape(e[6],lengthInsert.mtwo),insertTape(e[7],lengthInsert.mone),insertTape(e[8],lengthInsert.zero),insertTape(e[9],lengthInsert.one),insertTape(e[10],lengthInsert.two),insertTape(e[11],lengthInsert.three),insertTape(e[12],lengthInsert.four),insertTape(e[13],lengthInsert.five),insertTape(e[14],lengthInsert.six),insertTape(e[15],lengthInsert.seven),insertTape(e[16],lengthInsert.eight)}function removeTape(e){return d3.select("#t"+e).remove()}async function tourClick(){introJs().setOptions({steps:[{intro:" Q = { q0, q1, q2, q3, q4, q5, q6, q7, q8, q9, q10, q11, q12, q13 }, Σ = { B,T,P,S,X,V,E }, Γ = { _,B,T,P,S,X,V,E} }, S = { q0 }, Qaccept = { q7 }"},{element:document.querySelector("#btn-genValid"),intro:"dieser Button generiert einen gültigen Ausdruck"},{element:document.querySelector("#btn-genInvalid"),intro:"dieser Button generiert einen ungültigen Ausdruck"},{element:document.querySelector("#input"),intro:"hier kann ein manueller Ausdruck eingegeben werden"},{element:document.querySelector("#start"),intro:"dieser Button startet die automatische Verarbeitung"},{element:document.querySelector("#gen_but_corr"),intro:"dieser Button startet die step by step Verarbeitung"},{element:document.querySelector("#speed"),intro:"durch den Button wird der Ausdruck schneller verarbeitet"},{element:document.querySelector("#btn-cancel"),intro:"hier wird die TM wieder in den Initialzustand versetzt"},{element:document.querySelector("#btn-tour"),intro:"dieses Tutorial startet hier"},{element:document.querySelector("#btn-doc"),intro:"hier kann die Dokumentation gesehen werden"}]}).start()}$("input").keypress((function(e){if(checker=1,13===e.which){$("#header").css("visibility","visible");let e=$("#input").val();headerMovement(Object.assign([],e))}})),lengthInsert={meight:462,mseven:523,msix:584,mfive:645,mfour:705,mthree:765,mtwo:830,mone:890,zero:955,one:1015,two:1077,three:1139,four:1200,five:1261,six:1322,seven:1383,eight:1444};